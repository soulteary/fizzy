<%= turbo_frame_tag "my_menu", target: "_top" do %>
  <%= render "my/menus/jump" do %>
    <%= collapsible_nav_section "Boards" do %>
      <li class="popup__item" data-filter-target="item" data-navigable-list-target="item">
        <%= icon_tag "add", class: "popup__icon" %>
        <%= link_to new_board_path, class: "popup__btn btn" do %>
          <span class="overflow-ellipsis">Add a board</span>
        <% end %>
      </li>

      <% @boards.each do |board| %>
        <%= my_menu_board_item(board) %>
      <% end %>
    <% end %>

    <%= collapsible_nav_section "Custom views", id: "my-filters" do %>
      <%= form_with url: cards_path, method: :get, data: { controller: "form" } do |form| %>
        <li class="popup__item overflow-ellipsis" data-navigable-list-target="item" data-filter-target="item" id="filter-custom-create">
          <%= icon_tag "bookmark", class: "popup__icon" %>
          <%= link_to cards_path(expand_all: true), class: "popup__btn btn" do %>
            <span>Create a custom view</span>
          <% end %>
        </li>

        <% @filters.each do |filter| %>
          <%= my_menu_filter_item(filter) %>
        <% end %>
      <% end %>
    <% end %>

    <%= collapsible_nav_section "Tags" do %>
      <% @tags.each do |tag| %>
        <%= my_menu_tag_item(tag) %>
      <% end %>
    <% end %>

    <%= collapsible_nav_section "People" do %>
      <li class="popup__item" data-filter-target="item" data-navigable-list-target="item">
        <%= icon_tag "add", class: "popup__icon" %>
        <%= link_to account_join_code_path, class: "popup__btn btn" do %>
          <span class="overflow-ellipsis">Invite people</span>
        <% end %>
      </li>

      <% @users.each do |user| %>
        <%= my_menu_user_item(user) %>
      <% end %>
    <% end %>

    <%= collapsible_nav_section "Settings" do %>
      <%= filter_place_menu_item account_settings_path, "Account Settings", "settings" %>
      <%= filter_place_menu_item user_path(Current.user), "My Profile", "person" %>
      <%= filter_place_menu_item notifications_path, "All notifications", "bell" %>
      <%= filter_place_menu_item notifications_settings_path, "Notification Settings", "settings" %>

      <%= tag.li class: "popup__item", data: { filter_target: "item", navigable_list_target: "item" } do %>
        <%= icon_tag "logout", class: "popup__icon" %>
        <%= button_to session_url(script_name: nil), method: :delete, class: "popup__btn btn", data: { turbo: false } do %>
          <span>Sign out</span>
        <% end %>
      <% end %>
    <% end %>

    <% accounts = Current.identity.accounts.where.not(id: Current.account) %>
    <% if accounts.any? %>
      <% cache [ Current.identity, accounts ] do %>
        <%= collapsible_nav_section "Accounts" do %>
          <% accounts.each do |account| %>
            <%= filter_place_menu_item landing_url(script_name: account.slug), account.name, "marker", new_window: true %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <footer class="nav__footer">
    <strong class="txt-nowrap"><a href="https://www.fizzy.do" target="_blank" class="txt-ink"><%= icon_tag "fizzy", class: "v-align-middle" %> Fizzy™</a></strong> is designed, built, and backed by <strong class="txt-nowrap"><a href="https://37signals.com" target="_blank" class="txt-ink"><%= icon_tag "37signals", class: "v-align-middle" %> 37signals™</a></strong>
  </footer>
<% end %>
